From 7cb54243b2b040a9da681762919741f4fdd3314a Mon Sep 17 00:00:00 2001
From: Marek Goldmann <mgoldman@redhat.com>
Date: Thu, 12 Apr 2012 13:28:41 +0200
Subject: [PATCH 47/47] Simplified systemd files

---
 .../main/resources/bin/initscripts/jboss-as.conf   |   22 --------------------
 .../bin/initscripts/systemd/jboss-as.conf          |    4 ++++
 .../bin/initscripts/systemd/jboss-as.service       |    9 +++++---
 .../resources/bin/initscripts/sysv/jboss-as.conf   |   22 ++++++++++++++++++++
 build/src/main/resources/bin/standalone.sh         |    4 ++++
 5 files changed, 36 insertions(+), 25 deletions(-)
 delete mode 100644 build/src/main/resources/bin/initscripts/jboss-as.conf
 create mode 100644 build/src/main/resources/bin/initscripts/systemd/jboss-as.conf
 create mode 100644 build/src/main/resources/bin/initscripts/sysv/jboss-as.conf

diff --git a/build/src/main/resources/bin/initscripts/jboss-as.conf b/build/src/main/resources/bin/initscripts/jboss-as.conf
deleted file mode 100644
index cbe4aa7..0000000
--- a/build/src/main/resources/bin/initscripts/jboss-as.conf
+++ /dev/null
@@ -1,22 +0,0 @@
-# General configuration for the init.d scripts,
-# not necessarily for JBoss AS itself.
-
-# The username who should own the process.
-#
-JBOSS_USER=jboss-as
-
-# The amount of time to wait for startup
-#
-# STARTUP_WAIT=30
-
-# The amount of time to wait for shutdown
-#
-# SHUTDOWN_WAIT=30
-
-# Location to keep the console log
-#
-# JBOSS_CONSOLE_LOG=/var/log/jboss-as/console.log
-
-# The configuration you want to run
-#
-JBOSS_CONFIG=standalone-web.xml
diff --git a/build/src/main/resources/bin/initscripts/systemd/jboss-as.conf b/build/src/main/resources/bin/initscripts/systemd/jboss-as.conf
new file mode 100644
index 0000000..82699ad
--- /dev/null
+++ b/build/src/main/resources/bin/initscripts/systemd/jboss-as.conf
@@ -0,0 +1,4 @@
+# The configuration you want to run
+#
+JBOSS_CONFIG=standalone-web.xml
+
diff --git a/build/src/main/resources/bin/initscripts/systemd/jboss-as.service b/build/src/main/resources/bin/initscripts/systemd/jboss-as.service
index b7a4a56..1542968 100644
--- a/build/src/main/resources/bin/initscripts/systemd/jboss-as.service
+++ b/build/src/main/resources/bin/initscripts/systemd/jboss-as.service
@@ -3,10 +3,13 @@ Description=The JBoss Application Server
 After=syslog.target network.target
 
 [Service]
-Type=forking
+Environment=LAUNCH_JBOSS_IN_BACKGROUND=1
+EnvironmentFile=-/etc/jboss-as.conf
+User=jboss-as
+LimitNOFILE=102642
 PIDFile=/var/run/jboss-as/jboss-as.pid
-ExecStart=/usr/bin/jboss-as $OPTIONS start
-ExecStop=/usr/bin/jboss-as stop
+ExecStart=/usr/share/jboss-as/bin/standalone.sh -c $JBOSS_CONFIG
 
 [Install]
 WantedBy=multi-user.target
+
diff --git a/build/src/main/resources/bin/initscripts/sysv/jboss-as.conf b/build/src/main/resources/bin/initscripts/sysv/jboss-as.conf
new file mode 100644
index 0000000..d999aca
--- /dev/null
+++ b/build/src/main/resources/bin/initscripts/sysv/jboss-as.conf
@@ -0,0 +1,22 @@
+# General configuration for the init.d scripts,
+# not necessarily for JBoss AS itself.
+
+# The username who should own the process.
+#
+# JBOSS_USER=jboss-as
+
+# The amount of time to wait for startup
+#
+# STARTUP_WAIT=30
+
+# The amount of time to wait for shutdown
+#
+# SHUTDOWN_WAIT=30
+
+# Location to keep the console log
+#
+# JBOSS_CONSOLE_LOG=/var/log/jboss-as/console.log
+
+# The configuration you want to run
+#
+# JBOSS_CONFIG=standalone.xml
diff --git a/build/src/main/resources/bin/standalone.sh b/build/src/main/resources/bin/standalone.sh
index d7387f9..1e02120 100755
--- a/build/src/main/resources/bin/standalone.sh
+++ b/build/src/main/resources/bin/standalone.sh
@@ -147,6 +147,10 @@ fi
 if [ "x$JBOSS_CONFIG_DIR" = "x" ]; then
    JBOSS_CONFIG_DIR="$JBOSS_BASE_DIR/configuration"
 fi
+# determine the default pid file location dir, if not set
+if [ "x$JBOSS_PIDFILE" = "x" ]; then
+   JBOSS_PIDFILE="/var/run/jboss-as/jboss-as.pid"
+fi
 
 # For Cygwin, switch paths to Windows format before running java
 if $cygwin; then
-- 
1.7.10

